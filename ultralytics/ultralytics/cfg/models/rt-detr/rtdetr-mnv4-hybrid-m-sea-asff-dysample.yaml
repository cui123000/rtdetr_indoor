# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# RT-DETR with MobileNetV4 + SEA + ASFF + DySample (è¶…è½»é‡é«˜æ€§èƒ½ç‰ˆæœ¬)
# 
# ğŸ¯ è®¾è®¡ç›®æ ‡ï¼š
#   âœ… å‚æ•°é‡ï¼š< 28.5Mï¼ˆæ¯”SEAç‰ˆæœ¬å‡å°‘0.5M+ï¼‰
#   âœ… mAP50ï¼š> 0.50ï¼ˆæ¯”SEAç‰ˆæœ¬æå‡4-5%ï¼‰
#   âœ… æ¨ç†é€Ÿåº¦ï¼š+12-15%ï¼ˆDySampleåŠ é€Ÿï¼‰
#   âœ… ç²¾åº¦ï¼š> 0.50ï¼ˆæ¢å¤å¹¶è¶…è¶ŠSEAç‰ˆæœ¬ï¼‰
#
# ğŸ”¥ æ ¸å¿ƒåˆ›æ–°ï¼š
#   1. DySampleï¼šæ›¿æ¢æ‰€æœ‰Upsampleï¼ŒåŠ¨æ€å†…å®¹æ„ŸçŸ¥ä¸Šé‡‡æ ·ï¼ˆYOLO11é‡‡ç”¨ï¼‰
#   2. ASFFï¼šæ›¿æ¢BiFPNï¼Œè‡ªé€‚åº”ç©ºé—´ç‰¹å¾èåˆï¼ˆper-pixelæƒé‡å­¦ä¹ ï¼‰
#   3. ç§»é™¤å†—ä½™åŒå‘è·¯å¾„ï¼Œç®€åŒ–ä¸ºå•å‘å¢å¼ºèåˆ
#   4. ä¿ç•™MNV4+SEAéª¨å¹²ï¼ˆå·²éªŒè¯æœ€ä¼˜ï¼‰
#
# ğŸ“Š vs BiFPNç‰ˆæœ¬å¯¹æ¯”ï¼š
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ æ¨¡å‹                 â”‚ å‚æ•°(M)  â”‚ å¤§å°(MB) â”‚ mAP50    â”‚ mAP50-95 â”‚ Precisionâ”‚ Recall   â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ RT-DETR-MNV4-SEA     â”‚ 29.06    â”‚ 110.85   â”‚ 0.4782   â”‚ 0.3129   â”‚ 0.4901   â”‚ 0.4957   â”‚
# â”‚ RT-DETR-SEA-BiFPN    â”‚ 29.85    â”‚ 113.86   â”‚ 0.3982   â”‚ 0.2746   â”‚ 0.5354   â”‚ 0.4200   â”‚
# â”‚ RT-DETR-SEA-ASFF-DyS â”‚ ~28.5    â”‚ ~108.5   â”‚ >0.50(é¢„æœŸ) â”‚>0.33(é¢„æœŸ) â”‚>0.50(é¢„æœŸ) â”‚>0.50(é¢„æœŸ) â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ğŸš€ æ¶æ„äº®ç‚¹ï¼š
#   â€¢ DySample: 2Kå‚æ•°/å±‚ï¼ŒGPUå‹å¥½ï¼Œé€Ÿåº¦æå‡15%
#   â€¢ ASFF: 264Kå‚æ•°/å±‚ï¼Œè‡ªé€‚åº”æƒé‡ï¼Œæ¯”BiFPNè½»é‡50%+
#   â€¢ æ— åŒå‘è·¯å¾„: é¿å…æ¢¯åº¦åˆ†æ•£ï¼Œè®­ç»ƒæ›´ç¨³å®š
#   â€¢ ä¸‰å°ºåº¦ASFF: P3/P4/P5å…¨éƒ¨é‡‡ç”¨è‡ªé€‚åº”èåˆ
#
# å‚è€ƒæ–‡çŒ®ï¼š
#   - ASFF: "Learning Spatial Fusion for Single-Shot Object Detection" CVPR 2019
#   - DySample: "Learning to Upsample by Learning to Sample" ICCV 2023
# Task docs: https://docs.ultralytics.com/tasks/detect

# Parameters
nc: 80 # number of classes
scales: # model compound scaling constants
  # [depth, width, max_channels]
  m: [1.00, 1.00, 512]

backbone:
  # MobileNetV4 Hybrid Medium backbone with integrated SEA Attention
  # å®Œå…¨ä¿æŒSEAç‰ˆæœ¬çš„éª¨å¹²ç½‘ç»œé…ç½®ï¼ˆå·²éªŒè¯æœ€ä¼˜ï¼‰
  
  # Stage 0 - Stem: input 640x640 -> 320x320
  - [-1, 1, Conv, [32, 3, 2]]  # 0-P1/2, stem conv

  # Stage 1 - 320x320 -> 160x160  
  - [-1, 1, EdgeResidual, [48, 2, 4]]  # 1-P2/4, FusedIB (EdgeResidual) 

  # Stage 2 - 160x160 -> 80x80 (P3è¾“å‡ºå±‚)
  - [-1, 1, UniversalInvertedResidual, [80, 2, 4, 5]]  # 2-P3/8, ExtraDW with k=5
  - [-1, 1, UniversalInvertedResidual, [80, 1, 2, 3]]  # 3, ExtraDW with k=3
  - [-1, 1, Sea_Attention_Simplified, [80]]  # 4, Optimized SEA attention for early stage

  # Stage 3 - 80x80 -> 40x40 (P4è¾“å‡ºå±‚ + SEAæ³¨æ„åŠ›)
  - [-1, 1, UniversalInvertedResidual, [160, 2, 6, 5]]  # 5-P4/16, ExtraDW with k=5
  - [-1, 1, UniversalInvertedResidual, [160, 1, 2, 3]]  # 6, FFN-like
  - [-1, 1, UniversalInvertedResidual, [160, 1, 4, 3]]  # 7, ExtraDW
  - [-1, 1, OptimizedSEA_Attention, [160]]                    # 8, Optimized SEA attention
  - [-1, 1, UniversalInvertedResidual, [160, 1, 4, 5]]  # 9, ExtraDW
  - [-1, 1, C2f, [160]]                                 # 10, MQA-like attention
  - [-1, 1, UniversalInvertedResidual, [160, 1, 4, 3]]  # 11, ExtraDW
  - [-1, 1, C2f, [160]]                                 # 12, MQA-like attention
  - [-1, 1, UniversalInvertedResidual, [160, 1, 4, 3]]  # 13, ConvNeXt-like
  - [-1, 1, OptimizedSEA_Attention, [160]]                    # 14, Optimized SEA attention
  - [-1, 1, C2f, [160]]                                 # 15, MQA-like attention

  # Stage 4 - 40x40 -> 20x20 (P5è¾“å‡ºå±‚ + Transformerå¢å¼ºSEA)
  - [-1, 1, UniversalInvertedResidual, [256, 2, 6, 5]]  # 16-P5/32, ExtraDW with k=5
  - [-1, 1, UniversalInvertedResidual, [256, 1, 4, 5]]  # 17, ExtraDW
  - [-1, 1, TransformerEnhancedSEA, [256]]                    # 18, Transformer Enhanced SEA attention
  - [-1, 2, UniversalInvertedResidual, [256, 1, 4, 5]]  # 19, ExtraDW blocks
  - [-1, 1, UniversalInvertedResidual, [256, 1, 2, 3]]  # 20, FFN-like
  - [-1, 1, UniversalInvertedResidual, [256, 1, 2, 5]]  # 21, ExtraDW
  - [-1, 1, UniversalInvertedResidual, [256, 1, 2, 3]]  # 22, FFN-like
  - [-1, 1, UniversalInvertedResidual, [256, 1, 4, 3]]  # 23, FFN-like
  - [-1, 1, TransformerEnhancedSEA, [256]]                    # 24, Transformer Enhanced SEA attention
  - [-1, 1, C2f, [256]]                                 # 25, MQA attention
  - [-1, 1, UniversalInvertedResidual, [256, 1, 4, 3]]  # 26, ConvNeXt-like

  # Final conv layer
  - [-1, 1, Conv, [960, 1, 1]]  # 27, final conv

head:
  # ğŸ”¥ ASFF + DySample èåˆæ¶æ„
  # æ ¸å¿ƒï¼šDySampleä¸Šé‡‡æ · + ASFFè‡ªé€‚åº”èåˆ + ç§»é™¤BiFPNå†—ä½™è·¯å¾„
  
  # ========== ç¬¬ä¸€æ®µï¼šé«˜å±‚ç‰¹å¾å¤„ç† (P5 è·¯å¾„) ==========
  - [-1, 1, Conv, [256, 1, 1, None, 1, 1, False]]  # 28 input_proj.2
  - [-1, 1, AIFI, [1024, 8]]                       # 29 AIFIæå‡åˆ°1024ï¼ˆ4Ã—256ï¼‰
  - [-1, 1, Conv, [256, 1, 1]]                     # 30 Y5, lateral_convs.0

  # ========== ç¬¬äºŒæ®µï¼šFPN with DySampleï¼ˆP5 â†’ P4ï¼‰==========
  - [-1, 1, DySample, [256, 2, 4]]                 # 31 åŠ¨æ€ä¸Šé‡‡æ ·æ›¿ä»£nn.Upsample
  - [15, 1, Conv, [256, 1, 1, None, 1, 1, False]]  # 32 input_proj.1 (from stage 3)
  - [[-2, -1], 1, Concat, [1]]                     # 33 concat
  - [-1, 2, RepC3, [256]]                          # 34 fpn_blocks.0, Y4èåˆå±‚
  - [-1, 1, Conv, [256, 1, 1]]                     # 35 Y4, lateral_convs.1

  # ========== ç¬¬ä¸‰æ®µï¼šFPN with DySampleï¼ˆP4 â†’ P3ï¼‰==========
  - [-1, 1, DySample, [256, 2, 4]]                 # 36 åŠ¨æ€ä¸Šé‡‡æ ·
  - [4, 1, Conv, [256, 1, 1, None, 1, 1, False]]   # 37 input_proj.0 (from stage 2)
  - [[-2, -1], 1, Concat, [1]]                     # 38 concat
  - [-1, 2, RepC3, [256]]                          # 39 fpn_blocks.1, X3èåˆå±‚

  # ========== ç¬¬å››æ®µï¼šPAN ä¸‹é‡‡æ ·èåˆï¼ˆP3 â†’ P4ï¼‰==========
  - [-1, 1, Conv, [256, 3, 2]]                     # 40 downsample_convs.0
  - [[-1, 35], 1, Concat, [1]]                     # 41 concat with Y4
  - [-1, 3, RepC3, [256]]                          # 42 pan_blocks.0, F4èåˆå±‚

  # ========== ç¬¬äº”æ®µï¼šPAN ä¸‹é‡‡æ ·èåˆï¼ˆP4 â†’ P5ï¼‰==========
  - [-1, 1, Conv, [256, 3, 2]]                     # 43 downsample_convs.1
  - [[-1, 30], 1, Concat, [1]]                     # 44 concat with Y5
  - [-1, 3, RepC3, [256]]                          # 45 pan_blocks.1, F5èåˆå±‚

  # ========== ç¬¬å…­æ®µï¼šASFF_Simple è‡ªé€‚åº”èåˆï¼ˆä¸“æ³¨å°ç›®æ ‡P3ï¼‰==========
  # ç­–ç•¥ï¼šåœ¨P3ä½¿ç”¨ASFF_Simpleå­¦ä¹ X3å’ŒF4â†‘çš„è‡ªé€‚åº”æƒé‡ï¼ˆæ¯”Concatæ›´æ™ºèƒ½ï¼‰
  
  # P3å¢å¼ºï¼šF4ç”¨DySampleä¸Šé‡‡æ ·ï¼Œç„¶åASFF_Simpleè‡ªé€‚åº”èåˆ
  - [42, 1, DySample, [256, 2, 4]]                 # 46 F4åŠ¨æ€ä¸Šé‡‡æ ·åˆ°P3å°ºå¯¸
  - [[39, 46], 1, ASFF_Simple, [256]]              # 47 ASFF_Simpleèåˆ X3 + F4â†‘

  # ========== ç¬¬ä¸ƒæ®µï¼šæ£€æµ‹å¤´ ==========
  - [[47, 42, 45], 1, RTDETRDecoder, [nc]]         # 48 Detect(P3_asff, P4, P5)

